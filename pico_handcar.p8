pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include cart.p8
#include settings.p8
#include ui.p8
#include upgrades.p8
#include utils.p8
#include world.p8
#include title.p8

gamestate = 'title'

function _init()
	init_settings()
	
	if gamestate == 'title' then
		init_topo()
		init_title()
	end

	if gamestate == 'pump' then
		init_cart()
		init_rocks()
		init_fx()
		init_upgrades()
	end
end

function _update60()
	if gamestate == 'title' then
		update_title()
		update_topo()
	end
	if gamestate == 'pump' then
		pump_minigame()
		cart_physics()
		update_topo()
		update_rocks()
		update_fx() 
		update_upgrades()
	end
end

function _draw()
	if gamestate == 'title' then
		cls(12)
		draw_topo()
		draw_title()
	end
	if gamestate == 'pump' then
		cls(12)
		draw_topo()
		draw_cart()
		draw_rocks()
		draw_fx()
		draw_ui()
		draw_upgrades()
	end
end

--[[
Special thanks:

Particle FX base function
https://nerdyteachers.com/PICO-8/Game_Mechanics/?tutorial=14

Tomorrow Night font by VEXED
https://v3x3d.itch.io/tomorrow-night
]]

__gfx__
00b00a7a00004440c0cc0000000008880999ff0000000000000000000dddddd0000000000000000000055550000000002888800000000000000f000000000000
0b00aaa7004fff44ccccc000000088ef9999999000000000000000005ddddddd000550000005d550055dddda000000000288800000000000f00f000000000000
bbb7aa7904fff999cdccd00000088efe33333330000000000000000055ddddd5000550000055daa50ddddaaa00dd05500288880000000000f0f000f000000000
0baa7a904fff9999d0dd00000888efe9aaaaaaaa00000000000000000555dd55005d5500055dddda5ddddddd0ddda5550028880000000000ff0000f000000000
b37a9900ff999999000c0cc08efefe90a44a44a400000000000000000055d55005ddd5505adaaddd5aaadddddddd5d5500288880000000000ff0ff00000b00b0
33999b0049999994000cccccefef9900a444444400000000000000000055d50005ddd555addddddd5addddd5adad55a5000288800000000000ff00000b0b0b00
3993b00b04994440000cdccdfef90000449989900000000000000000555dd5505ddddd55ddddaaadaadddd555dd555550002888800000000000ff0000bbbbb00
93333bb000444000000d0dd09990000009999f000000000000000000dddddd555dddddd5dddaddddadddda550dd5a5a50000288800000000000f000000b0b000
00000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000700000000000000000000000000000000000000000000000000000000000000000000000000888880000000000009009000000000
0000000000000000000000060000000000000000000000000000000000000000000000000000000000000000000000002288888800000000090b090000000000
000000000000000000000066600000000000000000000000000000000000044000000000000044000000000000000000078788880000000000b00b0000065550
000000000000000000000666660000000000000000000000000000000000044400000000000044400000000000000000027888880000000000b0b0000665565d
0000000000000000000006676600000000000000000000000000000000000444040000000000444040000000004400000787888800000000000bb0006555555d
00000000000000000000660706600000000000000000000000000000000044444000000000044444000000000044400002888888000000000000b000655555dd
0000000000000000000066070660000000000000000000000000000000040fff000000000040fff0000000000044404000888800000000000000b0005555dddd
0066666666666666666666676666666666666666666666660000000000000fff000000000000fff0000000000444440000000000000000000000000000000000
00688888888888888888688788688888888888888888888600000044fcc00ff1000000000000ff100000000040fff00000025000000000000006556000000000
06888888888888888886688888668888888888888888886200000044fccc811100000000000811100000000000fff00000025500000000000065555500f00000
0688888888888888888888888888888888888888888888600000077000ccccc1000000000081cc100000000000fff10005525550000000000655555600ff0f00
766666666666666666666666666666666666666666666720000770000000ccc10000044fcccccc100000000000811100055255550000000006555655000f0ff0
76866686668666866686668666866686668666866686672000000000000011110077744fccccc1100000000000cc110005525550000000000556555d00ffff00
78888822222222222222222222222222222222228888870000000000000111110000000000111110077000000ccc11000002550000000000055555dd0000f000
6888222666666666222222222222266666666622288886000000000000011111000000000011111000077000ccc11100000250000000000000556dd00000f000
88822000066666000000000000000006666600002288866000000000000444440000000000444440000044fccc111100000000000000000000b3300000000000
882000000666660000000000000000066666000002288860000000000000cccc00000000000cccc0000044fcc44444000000000000000000000b3b0000bbb000
820000000066600000000000000000006660000000288860000000000000cccc00000000000cccc0000000000ccccc000000000000000000000330000b838bb0
80000000000600000000000000000000060000000022886000000000000ccc110000000000ccc11000000000cccccc00055560000000000000b33b00be333e3b
80000000000000000000000000000000000000000002888000000000000cc0110000000000cc011000000000ccc0110002556666000000000003b000b333833b
00000000000000000000000000000000000000000002288000000000000cc0110000000000cc0110000000000cc01100055560000000000000033b00b3e333e0
000000000000000000000000000000000000000000002880000000000044455500000000044455500000000044455500000000000000000000b330000b3338b0
000000000000000000000000000000000000000000002880000000000044455500000000044455500000000044455500000000000000000000033b0000b83b00
00000999990000000000099999000000000009999900000000000999990000000000000000000000000000000000000000000000000000000000000000000000
00099004009900000009900000990000000990000099000000099000009900000000000000000000000000000000000000000000000000000000000000000000
00900004000090000090000004009000009000000000900000900400000090000000000000000000000000000000000000000000000000000000000000000000
04000004000009000400000004000900040400000004090004000400000009000000000000000000000000000000000000000000000000000000000000000000
04000004000009000400000040000900040040000040090004000040000009000000000000000000000000000000000000000000000000000000000000000000
40000004000000904044000040000090400004000400009040000040000440900000000000000000000000000000000000000000000000000000000000000000
40000047400000904000444740000090400000474000009040000047444000900000000000000000000000000000000000000000000000000000000000000000
44444466644444404000006660000040400000666000004040000066600000400000000000000000000000000000000000000000000000000000000000000000
4000004d400000404000004d444000404000004d400000404000444d400000400000000000000000000000000000000000000000000000000000000000000000
40000004000000404000004000044040400004000400004040440000400000400000000000000000000000000000000000000000000000000000000000000000
04000004000004000400004000000400040040000040040004000000400004000000000000000000000000000000000000000000000000000000000000000000
04000004000004000400040000000400040400000004040004000000040004000000000000000000000000000000000000000000000000000000000000000000
00400004000040000040040000004000004000000000400000400000040040000000000000000000000000000000000000000000000000000000000000000000
00044004004400000004400000440000000440000044000000044000004400000000000000000000000000000000000000000000000000000000000000000000
00000444440000000000044444000000000004444400000000000444440000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000bbbbbbb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00bbbbbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb555bbb555bb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb555b555bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbb55555bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbb555bbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbb55555bbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbb555b555bbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb555bbb555bbb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbbbbbbbbbbb300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33bbbbbbbbbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3333bbbbbbb333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03333333333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00033333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000333330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
4041000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5051000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
